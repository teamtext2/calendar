<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lịch Tương Lai ✨</title>
  <style>
    :root {
      --primary: #007aff;
      --primary-light: #66b0ff;
      --white: #ffffff;
      --bg: #f7f9fc;
      --text: #1c2526;
      --glass-bg: rgba(255, 255, 255, 0.3);
      --glass-border: rgba(255, 255, 255, 0.5);
      --shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      --shadow-deep: 0 6px 20px rgba(0, 0, 0, 0.15), inset 0 -2px 4px rgba(255, 255, 255, 0.2);
      --radius: 24px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Inter", system-ui, sans-serif;
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(180deg, #e5efff, #d4e2ff);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      height: 100vh;
      padding: 0;
      overflow: hidden;
    }

    .calendar-app {
      width: 100%;
      max-width: 1000px;
      height: 100vh;
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
    }

    /* HEADER */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.4), rgba(255, 255, 255, 0.2));
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--glass-border);
      flex-shrink: 0;
    }

    .nav-buttons button {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      width: 44px;
      height: 44px;
      font-size: 20px;
      color: var(--primary);
      box-shadow: var(--shadow-deep);
      cursor: pointer;
      transition: var(--transition);
    }

    .nav-buttons button:hover {
      transform: translateY(-2px);
      background: var(--primary-light);
      color: var(--white);
      box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
    }

    .date-selector button {
      background: transparent;
      border: none;
      color: var(--primary);
      font-weight: 600;
      font-size: 16px;
      margin: 0 8px;
      cursor: pointer;
      transition: var(--transition);
    }

    .date-selector button:hover {
      color: #0051cc;
    }

    .menu-dots {
      font-size: 28px;
      color: var(--text);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 12px;
      transition: var(--transition);
    }

    .menu-dots:hover {
      background: var(--glass-bg);
      box-shadow: var(--shadow);
    }

    /* CALENDAR */
    .calendar-container {
      background: transparent;
      padding: 20px;
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
    }

    #calendarDisplay {
      text-align: center;
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 12px;
      flex-shrink: 0;
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      color: #5c6b73;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 12px;
      flex-shrink: 0;
    }

    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      flex: 1;
      min-height: 0;
    }

    .day-cell {
      background: var(--glass-bg);
      backdrop-filter: blur(8px);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }

    .day-cell:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.2);
    }

    .day-cell.inactive {
      color: #8e9ba3;
      background: rgba(255, 255, 255, 0.1);
      box-shadow: none;
    }

    .day-number {
      font-size: 16px;
      font-weight: 600;
      color: var(--text);
    }

    .current-day {
      background: var(--primary);
      color: var(--white);
      border-radius: 50%;
      padding: 10px 14px;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(0, 122, 255, 0.5);
    }

    .event-dot {
      position: absolute;
      bottom: 10px;
      width: 8px;
      height: 8px;
      background: #ff3b30;
      border-radius: 50%;
      box-shadow: 0 0 6px rgba(255, 59, 48, 0.5);
    }

    /* ADD BUTTON */
    .add-btn {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: linear-gradient(135deg, #007aff, #0051cc);
      color: var(--white);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      font-size: 30px;
      cursor: pointer;
      box-shadow: var(--shadow-deep), 0 0 12px rgba(0, 122, 255, 0.4);
      transition: var(--transition);
      z-index: 50;
    }

    .add-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 10px 30px rgba(0, 122, 255, 0.5);
      filter: brightness(1.2);
    }

    /* MODALS */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
      padding: 20px;
      overflow: auto;
    }

    .modal-content {
      background: var(--glass-bg);
      backdrop-filter: blur(12px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      width: min(450px, 90vw);
      max-height: 80vh;
      overflow-y: auto;
      animation: slideIn 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .modal-content h3 {
      color: var(--primary);
      margin-bottom: 16px;
      font-size: 20px;
      font-weight: 600;
    }

    input, textarea {
      width: 100%;
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 12px;
      font-size: 14px;
      margin-bottom: 12px;
      transition: var(--transition);
    }

    input:focus, textarea:focus {
      background: rgba(255, 255, 255, 0.6);
      border-color: var(--primary);
      outline: none;
    }

    .event-form button,
    .modal-content button {
      width: 100%;
      background: var(--primary);
      color: var(--white);
      border: none;
      padding: 12px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow-deep);
      margin-top: 8px;
    }

    .event-form button:hover,
    .modal-content button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 122, 255, 0.3);
      filter: brightness(1.1);
    }

    .modal-content button[style*="background: #ccc"] {
      background: rgba(255, 255, 255, 0.4);
      color: var(--text);
      box-shadow: var(--shadow);
    }

    .modal-content button[style*="background: #ff3b30"] {
      background: #ff3b30;
      box-shadow: var(--shadow);
    }

    /* Responsive Optimizations */
    @media (max-width: 768px) {
      body { padding: 0; }
      .calendar-app { max-width: 100%; height: 100vh; border-radius: 0; }
      .header { padding: 12px 16px; }
      .calendar-container { padding: 16px; }
      .weekdays span { font-size: 12px; }
      .days-grid { gap: 8px; }
      .day-number { font-size: 14px; }
      .add-btn { width: 52px; height: 52px; font-size: 26px; bottom: 20px; right: 20px; }
      .nav-buttons button { width: 40px; height: 40px; font-size: 18px; }
      .date-selector button { font-size: 14px; margin: 0 6px; }
      #calendarDisplay { font-size: 16px; }
    }

    @media (max-width: 480px) {
      .calendar-app { max-width: 100%; }
      .add-btn { width: 48px; height: 48px; font-size: 24px; bottom: 16px; right: 16px; }
      .modal-content { padding: 16px; width: 95vw; }
      input, textarea { font-size: 12px; padding: 10px; }
      .event-form button, .modal-content button { padding: 10px; font-size: 14px; }
      .modal-content h3 { font-size: 18px; }
      .weekdays span { font-size: 10px; }
      .day-number { font-size: 12px; }
      .event-dot { bottom: 6px; width: 6px; height: 6px; }
    }

    /* Dynamic Height Adjustment for Day Cells */
    .days-grid > .day-cell {
      height: calc((100% - 40px) / 6); /* Assume max 6 rows, adjust gap */
    }

    @media (max-height: 600px) {
      .days-grid > .day-cell {
        height: calc((100% - 30px) / 6);
      }
      .calendar-container { padding: 10px; }
      .header { padding: 10px 12px; }
    }
  </style>
</head>
<body>
  <div class="calendar-app">
    <div class="header">
      <div class="nav-buttons">
        <button id="prevMonthBtn">⟵</button>
        <button id="nextMonthBtn">⟶</button>
      </div>
      <div class="date-selector">
        <button id="monthSelector">Tháng</button>
        <button id="yearSelector">Năm</button>
      </div>
      <div class="menu-dots">⋮</div>
    </div>

    <div class="calendar-container">
      <div id="calendarDisplay"></div>
      <div class="weekdays">
        <span>CN</span><span>T2</span><span>T3</span><span>T4</span><span>T5</span><span>T6</span><span>T7</span>
      </div>
      <div id="daysGrid" class="days-grid"></div>
    </div>
  </div>

  <button id="addEventBtn" class="add-btn">+</button>

  <!-- Modals -->
  <div id="selectorModal" class="modal">
    <div class="modal-content">
      <h3 id="selectorTitle">Chọn...</h3>
      <div id="selectorList"></div>
      <button onclick="closeModal('selectorModal')" style="background:#ccc;">Đóng</button>
    </div>
  </div>

  <div id="eventFormModal" class="modal">
    <div class="modal-content">
      <h3>Thêm sự kiện cho <span id="eventDateDisplay"></span></h3>
      <form id="eventForm" class="event-form">
        <input type="hidden" id="eventDayDate">
        <input type="text" id="eventTitle" placeholder="Tên sự kiện" required>
        <textarea id="eventDetails" placeholder="Chi tiết (tùy chọn)"></textarea>
        <button type="submit">Lưu</button>
      </form>
      <button onclick="closeModal('eventFormModal')" style="background:#ccc;">Đóng</button>
    </div>
  </div>

  <div id="eventDetailsModal" class="modal">
    <div class="modal-content">
      <h3>Sự kiện ngày <span id="popupEventDate"></span></h3>
      <div id="eventDetailsContent"></div>
      <button onclick="deleteEvent()" style="background:#ff3b30;">Xóa</button>
      <button onclick="closeModal('eventDetailsModal')" style="background:#ccc;">Đóng</button>
    </div>
  </div>

  <script>
    const monthNames = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];
    const calendarDisplay = document.getElementById("calendarDisplay");
    const daysGrid = document.getElementById("daysGrid");
    const monthSelectorBtn = document.getElementById("monthSelector");
    const yearSelectorBtn = document.getElementById("yearSelector");
    const selectorModal = document.getElementById("selectorModal");
    const selectorTitle = document.getElementById("selectorTitle");
    const selectorList = document.getElementById("selectorList");
    const eventFormModal = document.getElementById("eventFormModal");
    const eventDetailsModal = document.getElementById("eventDetailsModal");
    const popupEventDate = document.getElementById("popupEventDate");
    const eventDetailsContent = document.getElementById("eventDetailsContent");
    const eventForm = document.getElementById("eventForm");
    const eventDateDisplay = document.getElementById("eventDateDisplay");
    const eventDayDateInput = document.getElementById("eventDayDate");

    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let selectedDayForEvent = null;

    function loadEvents() {
      return JSON.parse(localStorage.getItem("calendarEvents") || "{}");
    }

    function saveEvents(e) {
      localStorage.setItem("calendarEvents", JSON.stringify(e));
    }

    function getEventsForDate(d) {
      return loadEvents()[d] || [];
    }

    function formatDate(d) {
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
    }

    function formatDisplayDate(d) {
      const p = d.split("-");
      return `${p[2]}/${p[1]}/${p[0]}`;
    }

    function renderCalendar() {
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();
      daysGrid.innerHTML = "";
      calendarDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
      monthSelectorBtn.textContent = monthNames[currentMonth];
      yearSelectorBtn.textContent = currentYear;

      let rowCount = Math.ceil((firstDay + daysInMonth) / 7);

      // Adjust day-cell height dynamically based on row count
      const gridHeight = daysGrid.clientHeight;
      const gapTotal = (rowCount - 1) * 10; // gap is 10px
      const cellHeight = (gridHeight - gapTotal) / rowCount;
      document.querySelectorAll('.day-cell').forEach(cell => {
        cell.style.height = `${cellHeight}px`;
      });

      for (let i = firstDay - 1; i >= 0; i--) {
        const prev = daysInPrevMonth - i;
        const cell = createCell(prev, "inactive");
        daysGrid.appendChild(cell);
      }

      const today = new Date();
      const events = loadEvents();
      for (let d = 1; d <= daysInMonth; d++) {
        const date = new Date(currentYear, currentMonth, d);
        const key = formatDate(date);
        const cell = createCell(d, "");
        if (today.toDateString() === date.toDateString()) {
          const span = cell.querySelector(".day-number");
          span.classList.add("current-day");
        }
        if (events[key]?.length) {
          const dot = document.createElement("div");
          dot.className = "event-dot";
          cell.appendChild(dot);
          cell.onclick = () => showEventDetails(key);
        } else {
          cell.onclick = () => showEventForm(key);
        }
        daysGrid.appendChild(cell);
      }

      // Fill remaining cells if needed to maintain grid
      const totalCells = rowCount * 7;
      const filledCells = firstDay + daysInMonth;
      for (let i = 1; i <= totalCells - filledCells; i++) {
        const cell = createCell(i, "inactive");
        daysGrid.appendChild(cell);
      }

      // Re-apply dynamic height after rendering
      document.querySelectorAll('.day-cell').forEach(cell => {
        cell.style.height = `${cellHeight}px`;
      });
    }

    function createCell(day, className) {
      const div = document.createElement("div");
      div.className = `day-cell ${className}`;
      const num = document.createElement("span");
      num.className = "day-number";
      num.textContent = day;
      div.appendChild(num);
      return div;
    }

    function changeMonth(x) {
      currentMonth += x;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }

    function showSelector(type) {
      selectorList.innerHTML = "";
      selectorTitle.textContent = type === "month" ? "Chọn tháng" : "Chọn năm";
      const opts = type === "month" ? monthNames.map((n, i) => ({ n, i })) : [...Array(11)].map((_, i) => ({ n: currentYear - 5 + i, i: currentYear - 5 + i }));
      opts.forEach(o => {
        const b = document.createElement("button");
        b.textContent = o.n;
        b.onclick = () => {
          if (type === "month") currentMonth = o.i;
          else currentYear = o.i;
          renderCalendar();
          closeModal("selectorModal");
        };
        selectorList.appendChild(b);
      });
      selectorModal.style.display = "flex";
    }

    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }

    function showEventForm(date) {
      selectedDayForEvent = date;
      eventDateDisplay.textContent = formatDisplayDate(date);
      eventDayDateInput.value = date;
      eventFormModal.style.display = "flex";
    }

    eventForm.onsubmit = e => {
      e.preventDefault();
      const title = document.getElementById("eventTitle").value;
      const details = document.getElementById("eventDetails").value;
      const date = eventDayDateInput.value;
      const ev = loadEvents();
      if (!ev[date]) ev[date] = [];
      ev[date].push({ title, details });
      saveEvents(ev);
      renderCalendar();
      closeModal("eventFormModal");
    };

    function showEventDetails(date) {
      selectedDayForEvent = date;
      const ev = getEventsForDate(date);
      popupEventDate.textContent = formatDisplayDate(date);
      eventDetailsContent.innerHTML = ev.length ? ev.map(e => `<b>${e.title}</b><p>${e.details || ""}</p><hr>`).join("") : "<p>Không có sự kiện</p>";
      eventDetailsModal.style.display = "flex";
    }

    function deleteEvent() {
      if (!selectedDayForEvent) return;
      const ev = loadEvents();
      delete ev[selectedDayForEvent];
      saveEvents(ev);
      renderCalendar();
      closeModal("eventDetailsModal");
    }

    document.getElementById("prevMonthBtn").onclick = () => changeMonth(-1);
    document.getElementById("nextMonthBtn").onclick = () => changeMonth(1);
    monthSelectorBtn.onclick = () => showSelector("month");
    yearSelectorBtn.onclick = () => showSelector("year");
    document.getElementById("addEventBtn").onclick = () => showEventForm(formatDate(new Date()));

    // Re-render on resize to adjust heights
    window.addEventListener('resize', renderCalendar);

    renderCalendar();
  </script>
</body>
</html>