<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Đếm ngược - Vibe</title>
  <style>
    :root{
      --bg: rgba(255,255,255,0.06);
      --card: rgba(255,255,255,0.06);
      --glass: rgba(255,255,255,0.07);
      --accent: rgba(255,255,255,0.9);
      --muted: rgba(255,255,255,0.7);
      --glass-border: rgba(255,255,255,0.12);
      --shadow: 0 10px 30px rgba(2,6,23,0.45);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;}
    body{
      margin:0;min-height:100%;
      background: linear-gradient(135deg, rgba(10,25,47,0.92), rgba(20,10,40,0.85));
      color:var(--accent);
      display:flex;align-items:center;justify-content:center;padding:20px;
      -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
    }

    .app{
      width:100%;max-width:980px;min-height:520px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius:18px;padding:18px;box-shadow:var(--shadow);
      backdrop-filter: blur(10px) saturate(120%);
      border:1px solid var(--glass-border);
      display:grid;grid-template-columns:1fr 360px;gap:16px;align-items:start;
    }

    @media (max-width:900px){
      .app{grid-template-columns:1fr;max-width:640px;padding:12px}
    }

    header{display:flex;align-items:center;gap:12px;margin-bottom:6px}
    .logo{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));border:1px solid var(--glass-border)}
    .header-text{display:flex;flex-direction:column}
    .app-title{font-weight:700;font-size:16px}
    .app-sub{font-size:12px;color:var(--muted)}

    /* main list */
    .list{padding:8px;border-radius:12px;min-height:360px;display:flex;flex-direction:column;gap:12px;align-items:stretch;overflow:auto}
    .empty{opacity:0.75;text-align:center;padding:36px;border:1px dashed var(--glass-border);border-radius:12px}

    /* card */
    .event-card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid var(--glass-border);padding:12px;border-radius:12px;display:flex;align-items:center;justify-content:space-between;gap:12px;backdrop-filter: blur(6px);}
    .left{display:flex;gap:12px;align-items:center;min-width:0}
    .badge{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border:1px solid var(--glass-border)}
    .meta{display:flex;flex-direction:column;min-width:0}
    .ename{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .edesc{font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .right{display:flex;flex-direction:column;align-items:flex-end;gap:6px}
    .time{font-weight:700;font-size:18px}
    .when{font-size:12px;color:var(--muted)}

    .controls{display:flex;gap:8px}

    /* icon-only buttons */
    .icon-btn{width:38px;height:38px;border-radius:10px;border:1px solid var(--glass-border);display:inline-flex;align-items:center;justify-content:center;background:transparent;cursor:pointer;padding:6px}
    .icon-btn svg{width:18px;height:18px}
    .icon-btn:hover{transform:translateY(-3px)}

    /* side panel */
    .side{display:flex;flex-direction:column;gap:12px}
    .add-block{padding:12px;border-radius:12px;background:var(--glass);border:1px solid var(--glass-border);backdrop-filter:blur(8px);display:flex;flex-direction:column;gap:10px}

    .add-header{display:flex;align-items:center;justify-content:space-between}

    /* form - hidden by default, toggled by class */
    form{display:none;flex-direction:column;gap:10px;margin-top:6px}
    form.open{display:flex}

    /* compact inputs with icon */
    .field{display:flex;align-items:center;gap:8px}
    .field input[type="text"], .field input[type="date"], textarea{
      background:transparent;border:1px solid var(--glass-border);padding:10px;border-radius:10px;color:var(--accent);outline:none;font-size:14px;flex:1
    }
    textarea{min-height:70px;resize:vertical}
    .field svg{width:18px;height:18px;opacity:0.9}

    .row{display:flex;gap:8px}
    .row > *{flex:1}

    .small{font-size:12px;color:var(--muted)}

    footer{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

    /* floating add for small screens */
    .fab{position:fixed;right:16px;bottom:16px;width:60px;height:60px;border-radius:50%;display:none;align-items:center;justify-content:center;font-size:30px;font-weight:700;border:1px solid var(--glass-border);background:linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));box-shadow:var(--shadow);cursor:pointer}
    @media (max-width:900px){.fab{display:flex}}

    /* modal for mobile form */
    .mobile-modal{display:none}
    .mobile-modal.open{display:flex;position:fixed;inset:0;background:linear-gradient(0deg, rgba(0,0,0,0.45), rgba(0,0,0,0.45));align-items:center;justify-content:center;padding:20px}
    .mobile-sheet{width:100%;max-width:560px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));padding:16px;border-radius:14px;border:1px solid var(--glass-border);}

    /* subtle transitions */
    .event-card{transition:transform .18s ease,opacity .18s ease}
  </style>
</head>
<body>
  <div class="app" role="application" aria-label="Ứng dụng đếm ngược">
    <main>
      <header>
        <div class="logo" aria-hidden>
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="20" height="20" rx="5" stroke="white" stroke-opacity="0.12"/><path d="M7 14c1-2 3-3 5-3s4 1 5 3" stroke="white" stroke-opacity="0.9" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="header-text">
          <div class="app-title">Vibe</div>
          <div class="app-sub">Đếm ngược</div>
        </div>
      </header>

      <section style="margin-top:6px">
        <div class="list" id="list" aria-live="polite">
          <!-- event cards injected here -->
        </div>
      </section>
      <footer id="info" style="margin-top:10px"></footer>
    </main>

    <aside class="side">
      <div class="add-block">
        <div class="add-header">
          <!-- icon-only header -->
          <div style="display:flex;align-items:center;gap:8px">
            <button id="toggleAdd" class="icon-btn" aria-label="Thêm sự kiện"> 
              <!-- plus -->
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5v14M5 12h14" stroke="white" stroke-opacity="0.9" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div class="small" style="font-weight:600">Thêm</div>
          </div>

          <div style="display:flex;gap:8px">
            <button id="clearAll" class="icon-btn" aria-label="Xóa tất cả">
              <!-- trash -->
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6M10 6V4a2 2 0 0 1 2-2h0a2 2 0 0 1 2 2v2" stroke="white" stroke-opacity="0.9" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </div>

        <!-- desktop form (side) -->
        <form id="form" class="" aria-hidden="true">
          <div class="field">
            <svg viewBox="0 0 24 24" fill="none" style="opacity:.9"><path d="M12 2v6" stroke="white" stroke-opacity="0.9" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <input id="name" type="text" placeholder="Tên sự kiện" aria-label="Tên sự kiện" required />
          </div>

          <div class="row">
            <div class="field">
              <svg viewBox="0 0 24 24" fill="none" style="opacity:.9"><rect x="3" y="4" width="18" height="15" rx="2" stroke="white" stroke-opacity="0.9" stroke-width="1.4"/></svg>
              <input id="date" type="date" aria-label="Ngày sự kiện" required />
            </div>
            <div class="field">
              <svg viewBox="0 0 24 24" fill="none" style="opacity:.9"><path d="M12 6v6l4 2" stroke="white" stroke-opacity="0.9" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <input id="timeLabel" type="text" placeholder="Nhãn" aria-label="Nhãn sự kiện (tùy chọn)" />
            </div>
          </div>

          <div class="field">
            <svg viewBox="0 0 24 24" fill="none" style="opacity:.9"><path d="M3 7v10a2 2 0 0 0 2 2h14" stroke="white" stroke-opacity="0.9" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <textarea id="desc" placeholder="Ghi chú (tùy chọn)" aria-label="Mô tả sự kiện"></textarea>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:6px">
            <button id="cancel" class="icon-btn" type="button" aria-label="Hủy">
              <!-- x -->
              <svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="white" stroke-opacity="0.9" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button id="save" class="icon-btn" type="submit" aria-label="Lưu">
              <!-- check -->
              <svg viewBox="0 0 24 24" fill="none"><path d="M20 6L9 17l-5-5" stroke="white" stroke-opacity="0.95" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
          </div>
        </form>

      </div>

      <div style="padding:12px;border-radius:12px;background:var(--glass);border:1px solid var(--glass-border);backdrop-filter:blur(8px);display:flex;flex-direction:column;gap:8px;align-items:start;">
        <div class="small" style="font-weight:600">Lưu cục bộ</div>
        <div class="small" id="localInfo">Dữ liệu lưu trên trình duyệt</div>
      </div>
    </aside>

  </div>

  <!-- floating add for mobile -->
  <div class="fab" id="fab" title="Thêm sự kiện" aria-hidden="false">
    <svg viewBox="0 0 24 24" fill="none" style="width:26px;height:26px"><path d="M12 5v14M5 12h14" stroke="white" stroke-opacity="0.95" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
  </div>

  <!-- mobile modal for form -->
  <div id="mobileModal" class="mobile-modal" aria-hidden="true">
    <div class="mobile-sheet">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <div id="mobileTitle" style="font-weight:700">Thêm</div>
        <button id="mobileClose" class="icon-btn" aria-label="Đóng">
          <svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="white" stroke-opacity="0.95" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
      <!-- mobile uses same form fields but shown here -->
      <form id="mobileForm">
        <div class="field"><label style="width:100%;font-size:13px;margin-bottom:6px">Tiêu đề</label><input id="m_name" type="text" placeholder="Tên sự kiện" aria-label="Tên sự kiện" required /></div>
        <div class="field"><label style="width:100%;font-size:13px;margin-bottom:6px">Ngày (ngày/tháng/năm)</label><input id="m_date" type="date" aria-label="Ngày sự kiện" required /></div>
        <div class="field"><label style="width:100%;font-size:13px;margin-bottom:6px">Nhãn (tùy chọn)</label><input id="m_label" type="text" placeholder="Nhãn" aria-label="Nhãn sự kiện (tùy chọn)" /></div>
        <div class="field"><label style="width:100%;font-size:13px;margin-bottom:6px">Mô tả (tùy chọn)</label><textarea id="m_desc" placeholder="Ghi chú (tùy chọn)" aria-label="Mô tả sự kiện"></textarea></div>
        <div class="field"><label style="width:100%;font-size:13px;margin-bottom:6px">Năm bắt đầu (tùy chọn)</label><input id="m_startYear" type="number" min="1900" max="3000" placeholder="Ví dụ: 2025" aria-label="Năm bắt đầu (tùy chọn)" /></div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button id="m_cancel" type="button" class="icon-btn" aria-label="Hủy">
            <svg viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6l12 12" stroke="white" stroke-opacity="0.95" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <button id="m_save" type="submit" class="icon-btn" aria-label="Lưu">
            <svg viewBox="0 0 24 24" fill="none"><path d="M20 6L9 17l-5-5" stroke="white" stroke-opacity="0.95" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // helpers
    const listEl = document.getElementById('list');
    const form = document.getElementById('form');
    const mobileModal = document.getElementById('mobileModal');
    const STORAGE_INFO = document.getElementById('localInfo');
    const mobileTitle = document.getElementById('mobileTitle');

    // in-memory events (not persisted)
    let eventsInMemory = [];
    let currentEditingId = null; // null when creating

    function uid(){return Math.random().toString(36).slice(2,9)}
    function loadEvents(){ return eventsInMemory.slice(); }
    function saveEvents(events){ eventsInMemory = events.slice(); }

    function daysBetween(dateA, dateB){const msPerDay = 24*60*60*1000;const utcA = Date.UTC(dateA.getFullYear(), dateA.getMonth(), dateA.getDate());const utcB = Date.UTC(dateB.getFullYear(), dateB.getMonth(), dateB.getDate());return Math.floor((utcB - utcA)/msPerDay);}
    function computeLabel(evDate){const today=new Date();const diff=daysBetween(today, evDate);if(diff>0)return{txt:`+${diff}`, passed:false, num:diff};if(diff===0)return{txt:`0`, passed:false, num:0};return{txt:`-${Math.abs(diff)}`, passed:true, num:Math.abs(diff)} }

    // render events
    function render(){
      const events = loadEvents().sort((a,b)=> new Date(a.date) - new Date(b.date));
      listEl.innerHTML='';
      if(events.length===0){
        const e=document.createElement('div');e.className='empty';e.innerHTML='<div style="font-weight:700;margin-bottom:6px">Chưa có sự kiện</div><div class="small">Ấn + để thêm</div>';
        listEl.appendChild(e);
      }else{
        events.forEach(ev=>{
          const card=document.createElement('div');card.className='event-card';

          const left=document.createElement('div');left.className='left';
          const badge=document.createElement('div');badge.className='badge';badge.textContent=(ev.timeLabel||ev.name||'?')[0].toUpperCase();
          const meta=document.createElement('div');meta.className='meta';
          const ename=document.createElement('div');ename.className='ename';ename.textContent=ev.name;
          const edesc=document.createElement('div');edesc.className='edesc';
          edesc.textContent = ev.timeLabel || '';
          if(ev.startYear){ edesc.textContent += (edesc.textContent ? ' · ' : '') + 'Năm bắt đầu: ' + ev.startYear; }
          meta.appendChild(ename);meta.appendChild(edesc);
          left.appendChild(badge);left.appendChild(meta);

          const right=document.createElement('div');right.className='right';
          const d=new Date(ev.date);
          const when=document.createElement('div');when.className='when small';when.textContent=d.toLocaleDateString(undefined,{year:'numeric',month:'short',day:'numeric'});
          const label=document.createElement('div');label.className='time';label.textContent=computeLabel(d).txt;

          const controls=document.createElement('div');controls.className='controls';

          // edit icon-only button
          const edit=document.createElement('button');edit.className='icon-btn';edit.setAttribute('aria-label','Sửa');edit.innerHTML='<svg viewBox="0 0 24 24" fill="none"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z" stroke="white" stroke-opacity="0.9" stroke-width="0"/></svg>';
          edit.addEventListener('click', ()=>{ openMobileModalForEdit(ev.id); });

          // delete icon-only button
          const del=document.createElement('button');del.className='icon-btn';del.setAttribute('aria-label','Xóa');del.innerHTML='<svg viewBox="0 0 24 24" fill="none"><path d="M3 6h18M8 6v12a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V6" stroke="white" stroke-opacity="0.95" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>';
          del.addEventListener('click', ()=>{ if(confirm('Xóa sự kiện "'+ev.name+'" ?')){ const rest = loadEvents().filter(x=>x.id!==ev.id); saveEvents(rest); render(); } });

          controls.appendChild(edit);
          controls.appendChild(del);

          right.appendChild(label);right.appendChild(when);right.appendChild(controls);
          card.appendChild(left);card.appendChild(right);
          listEl.appendChild(card);
        })
      }
      STORAGE_INFO.textContent = `${loadEvents().length} sự kiện · Không lưu (chỉ phiên hiện tại)`;
    }

    // show mobile modal for create or edit
    function openMobileModalForCreate(){
      currentEditingId = null;
      mobileTitle.textContent = 'Thêm';
      document.getElementById('m_name').value = '';
      document.getElementById('m_date').value = '';
      document.getElementById('m_label').value = '';
      document.getElementById('m_desc').value = '';
      document.getElementById('m_startYear').value = '';
      mobileModal.classList.add('open'); mobileModal.setAttribute('aria-hidden','false'); document.getElementById('m_name').focus();
    }

    function openMobileModalForEdit(id){
      const ev = loadEvents().find(x=>x.id===id); if(!ev) return;
      currentEditingId = id;
      mobileTitle.textContent = 'Sửa';
      document.getElementById('m_name').value = ev.name || '';
      document.getElementById('m_date').value = new Date(ev.date).toISOString().slice(0,10);
      document.getElementById('m_label').value = ev.timeLabel || '';
      document.getElementById('m_desc').value = ev.desc || '';
      document.getElementById('m_startYear').value = ev.startYear || '';
      mobileModal.classList.add('open'); mobileModal.setAttribute('aria-hidden','false'); document.getElementById('m_name').focus();
    }

    // wire buttons
    let formVisible = false; // desktop side form not used for add
    const toggleAddBtn = document.getElementById('toggleAdd');
    const fab = document.getElementById('fab');
    const cancelBtn = document.getElementById('cancel');

    // Make desktop Add button open the popup modal instead of side form
    toggleAddBtn.addEventListener('click', ()=>{ openMobileModalForCreate(); });
    fab.addEventListener('click', ()=>{ openMobileModalForCreate(); });
    cancelBtn.addEventListener('click', ()=>{ /* keep side form behavior: just hide */ form.classList.remove('open'); form.setAttribute('aria-hidden','true'); form.reset(); });

    // disable desktop form submission to avoid confusion; prefer modal
    form.addEventListener('submit', (e)=>{ e.preventDefault(); openMobileModalForCreate(); });

    // mobile modal handlers
    document.getElementById('mobileClose').addEventListener('click', ()=>{ mobileModal.classList.remove('open'); mobileModal.setAttribute('aria-hidden','true'); document.getElementById('mobileForm').reset(); currentEditingId = null; mobileTitle.textContent='Thêm'; });
    document.getElementById('m_cancel').addEventListener('click', ()=>{ mobileModal.classList.remove('open'); mobileModal.setAttribute('aria-hidden','true'); document.getElementById('mobileForm').reset(); currentEditingId = null; mobileTitle.textContent='Thêm'; });
    document.getElementById('mobileForm').addEventListener('submit', (e)=>{ 
      e.preventDefault(); 
      const name=document.getElementById('m_name').value.trim(); 
      const dateVal=document.getElementById('m_date').value; 
      if(!name||!dateVal){ alert('Vui lòng nhập tên và ngày.'); return } 
      const label=document.getElementById('m_label').value.trim(); 
      const desc=document.getElementById('m_desc').value.trim(); 
      const startYear = document.getElementById('m_startYear').value.trim();
      const eventDate=new Date(dateVal+'T00:00'); 
      const events = loadEvents(); 
      if(currentEditingId){
        // update
        const idx = events.findIndex(x=>x.id===currentEditingId);
        if(idx>-1){ events[idx] = { ...events[idx], name, date:eventDate.toISOString(), desc, timeLabel:label, startYear: startYear || undefined }; saveEvents(events); }
      }else{
        // create
        events.push({id:uid(), name, date:eventDate.toISOString(), desc, timeLabel:label, startYear: startYear || undefined});
        saveEvents(events);
      }
      mobileModal.classList.remove('open'); mobileModal.setAttribute('aria-hidden','true'); document.getElementById('mobileForm').reset(); currentEditingId = null; mobileTitle.textContent='Thêm'; render(); 
    });

    // clear all (in-memory)
    document.getElementById('clearAll').addEventListener('click', ()=>{ if(confirm('Xóa tất cả sự kiện?')){ eventsInMemory = []; render(); } });

    // auto refresh labels every minute
    setInterval(render, 60*1000);
    // initial render
    document.addEventListener('DOMContentLoaded', ()=>{ render(); });
  </script>
</body>
</html>
