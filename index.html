<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>Text2 — Calendar</title>
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#F5F5F5">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <style>
    :root {
      --primary: #8a5cf6; /* A modern, vibrant purple */
      --primary-light: #a78bfa;
      --white: #ffffff;
      --bg: #f7f9fc;
      --text: #e5e7eb; /* Lighter text for dark bg contrast */
      --text-dark: #1f2937;
      --text-muted: #9ca3af;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-highlight: rgba(255, 255, 255, 0.05);
      --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
      --radius-lg: 24px;
      --radius-md: 16px;
      --radius-sm: 12px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    /* --- BACKGROUND --- */
    body {
      background: #111827; /* Dark background to make glass pop */
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 16px;
      overflow: hidden;
      position: relative;
    }
    
    /* Animated Gradient Blobs */
    body::before, body::after {
        content: '';
        position: absolute;
        width: 400px;
        height: 400px;
        border-radius: 50%;
        filter: blur(100px);
        z-index: -1;
    }

    body::before {
        background: linear-gradient(135deg, var(--primary), #ec4899);
        top: 10%;
        left: 10%;
        animation: move-blob-1 15s infinite alternate;
    }

    body::after {
        background: linear-gradient(135deg, #22d3ee, #3b82f6);
        bottom: 10%;
        right: 10%;
        animation: move-blob-2 15s infinite alternate;
    }

    @keyframes move-blob-1 {
      from { transform: translate(-20%, -20%) rotate(0deg); }
      to { transform: translate(20%, 20%) rotate(360deg); }
    }

    @keyframes move-blob-2 {
      from { transform: translate(20%, 20%) rotate(0deg); }
      to { transform: translate(-20%, -20%) rotate(360deg); }
    }


    /* --- MAIN APP CONTAINER --- */
    .calendar-app {
      width: 100%;
      max-width: 1200px;
      height: calc(100vh - 32px);
      max-height: 800px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      border: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* --- HEADER --- */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      background: var(--glass-highlight);
      border-bottom: 1px solid var(--glass-border);
      flex-shrink: 0;
    }

    .nav-buttons, .date-selector {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .icon-btn, .date-selector button {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      color: var(--text);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .icon-btn {
      width: 40px;
      height: 40px;
    }
    
    .icon-btn svg {
      width: 20px;
      height: 20px;
    }

    .icon-btn:hover, .date-selector button:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.4);
      transform: translateY(-2px);
    }

    .date-selector button {
      padding: 8px 16px;
      font-weight: 500;
      font-size: 16px;
    }

    #calendarDisplay {
      text-align: center;
      font-weight: 600;
      font-size: 20px;
      color: var(--white);
      flex-grow: 1;
    }

    /* --- CALENDAR --- */
    .calendar-container {
      padding: 24px;
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      color: var(--text-muted);
      font-weight: 500;
      font-size: 14px;
      margin-bottom: 12px;
    }

    .days-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-template-rows: repeat(6, 1fr);
      gap: 12px;
      flex: 1;
      min-height: 0;
    }

    .day-cell {
      background: var(--glass-highlight);
      border: 1px solid transparent;
      border-radius: var(--radius-md);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      color: var(--text);
    }

    .day-cell:hover {
      transform: scale(1.05);
      border-color: var(--glass-border);
      background: rgba(255, 255, 255, 0.15);
    }
    
    .day-cell.inactive {
        color: var(--text-muted);
        background: transparent;
        pointer-events: none;
    }

    .day-number {
      font-size: 16px;
      font-weight: 500;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: var(--transition);
    }
    
    .day-cell:hover .day-number {
        color: var(--white);
    }

    .day-cell .current-day {
      background-color: var(--primary);
      color: var(--white);
      font-weight: 700;
      box-shadow: 0 0 15px rgba(138, 92, 246, 0.5);
    }

    .event-dot {
      position: absolute;
      bottom: 10px;
      width: 6px;
      height: 6px;
      background: var(--primary-light);
      border-radius: 50%;
      box-shadow: 0 0 8px var(--primary-light);
    }
    
    /* --- ADD BUTTON --- */
    .add-btn {
      position: absolute;
      bottom: 40px;
      right: 40px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: var(--white);
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(138, 92, 246, 0.4);
      transition: var(--transition);
      z-index: 50;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .add-btn:hover {
      transform: scale(1.1) rotate(90deg);
      box-shadow: 0 12px 30px rgba(138, 92, 246, 0.6);
    }

    /* --- MODALS --- */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(17, 24, 39, 0.5);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .modal.show {
        display: flex;
        opacity: 1;
    }

    .modal-content {
      background: var(--glass-bg);
      backdrop-filter: blur(25px);
      -webkit-backdrop-filter: blur(25px);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
      padding: 24px;
      width: min(450px, 90vw);
      max-height: 80vh;
      overflow-y: auto;
      color: var(--text);
      transform: scale(0.95);
      transition: transform 0.3s ease;
    }
    
    .modal.show .modal-content {
        transform: scale(1);
    }

    .modal-content h3 {
      color: var(--white);
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 600;
      text-align: center;
    }

    input, textarea {
      width: 100%;
      background: rgba(17, 24, 39, 0.5);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-sm);
      padding: 12px 16px;
      font-size: 16px;
      margin-bottom: 12px;
      transition: var(--transition);
      color: var(--text);
    }
    
    input::placeholder, textarea::placeholder {
        color: var(--text-muted);
    }

    input:focus, textarea:focus {
      background: rgba(17, 24, 39, 0.7);
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 10px rgba(138, 92, 246, 0.3);
    }

    .modal-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px;
      border-radius: var(--radius-sm);
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: var(--transition);
      border: none;
    }

    .btn-primary {
      background: var(--primary);
      color: var(--white);
      box-shadow: 0 4px 15px rgba(138, 92, 246, 0.3);
    }
    .btn-primary:hover {
      background: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(138, 92, 246, 0.4);
    }
    
    .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: var(--white);
    }
    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .btn-danger {
        background: #ef4444;
        color: var(--white);
    }
    .btn-danger:hover {
        background: #f87171;
    }
    
    #selectorList {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 10px;
    }
    
    #selectorList button {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: var(--text);
        padding: 10px;
        border-radius: var(--radius-sm);
        cursor: pointer;
        transition: var(--transition);
    }
    #selectorList button:hover {
        background: var(--primary);
        color: var(--white);
    }
    
    #eventDetailsContent b {
        color: var(--primary-light);
        display: block;
        font-size: 1.1em;
    }
    #eventDetailsContent p {
        margin: 4px 0 12px;
        line-height: 1.6;
    }
    #eventDetailsContent hr {
        border: none;
        height: 1px;
        background-color: var(--glass-border);
        margin-bottom: 12px;
    }


    /* --- RESPONSIVE --- */
    @media (max-width: 768px) {
      body { padding: 0; }
      .calendar-app { 
        height: 100vh; 
        max-height: none;
        border-radius: 0; 
      }
      .header { flex-wrap: wrap; justify-content: center; gap: 10px; padding: 12px 16px; }
      #calendarDisplay { order: -1; width: 100%; margin-bottom: 10px; font-size: 18px; }
      .calendar-container { padding: 16px; }
      .days-grid { gap: 8px; }
      .add-btn { width: 52px; height: 52px; bottom: 20px; right: 20px; }
    }
  </style>
</head>
<body>

  <div class="calendar-app">
    <div class="header">
      <div class="nav-buttons">
        <button id="prevMonthBtn" class="icon-btn" aria-label="Tháng trước">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <button id="nextMonthBtn" class="icon-btn" aria-label="Tháng sau">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>
      </div>
      <div id="calendarDisplay"></div>
      <div class="date-selector">
        <button id="monthSelector">Tháng</button>
        <button id="yearSelector">Năm</button>
      </div>
    </div>

    <div class="calendar-container">
      <div class="weekdays">
        <span>CN</span><span>T2</span><span>T3</span><span>T4</span><span>T5</span><span>T6</span><span>T7</span>
      </div>
      <div id="daysGrid" class="days-grid"></div>
    </div>
  </div>

  <button id="addEventBtn" class="add-btn" aria-label="Thêm sự kiện">
    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" style="width: 28px; height: 28px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
  </button>

  <!-- Modals -->
  <div id="selectorModal" class="modal">
    <div class="modal-content">
      <h3 id="selectorTitle">Chọn...</h3>
      <div id="selectorList"></div>
      <div class="modal-actions">
          <button onclick="closeModal('selectorModal')" class="modal-btn btn-secondary">Đóng</button>
      </div>
    </div>
  </div>

  <div id="eventFormModal" class="modal">
    <div class="modal-content">
      <h3>Thêm sự kiện cho <span id="eventDateDisplay"></span></h3>
      <form id="eventForm">
        <input type="hidden" id="eventDayDate">
        <input type="text" id="eventTitle" placeholder="Tên sự kiện" required>
        <textarea id="eventDetails" placeholder="Chi tiết (tùy chọn)" rows="3"></textarea>
        <div class="modal-actions">
            <button type="button" onclick="closeModal('eventFormModal')" class="modal-btn btn-secondary">Hủy</button>
            <button type="submit" class="modal-btn btn-primary">Lưu</button>
        </div>
      </form>
    </div>
  </div>

  <div id="eventDetailsModal" class="modal">
    <div class="modal-content">
      <h3>Sự kiện ngày <span id="popupEventDate"></span></h3>
      <div id="eventDetailsContent"></div>
      <div class="modal-actions">
        <button onclick="closeModal('eventDetailsModal')" class="modal-btn btn-secondary">Đóng</button>
        <button onclick="deleteEvent()" class="modal-btn btn-danger">Xóa</button>
      </div>
    </div>
  </div>

  <script>
    const monthNames = ["Tháng 1", "Tháng 2", "Tháng 3", "Tháng 4", "Tháng 5", "Tháng 6", "Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11", "Tháng 12"];
    const calendarDisplay = document.getElementById("calendarDisplay");
    const daysGrid = document.getElementById("daysGrid");
    const monthSelectorBtn = document.getElementById("monthSelector");
    const yearSelectorBtn = document.getElementById("yearSelector");
    
    const selectorModal = document.getElementById("selectorModal");
    const selectorTitle = document.getElementById("selectorTitle");
    const selectorList = document.getElementById("selectorList");
    
    const eventFormModal = document.getElementById("eventFormModal");
    const eventDetailsModal = document.getElementById("eventDetailsModal");
    
    const popupEventDate = document.getElementById("popupEventDate");
    const eventDetailsContent = document.getElementById("eventDetailsContent");
    const eventForm = document.getElementById("eventForm");
    const eventDateDisplay = document.getElementById("eventDateDisplay");
    const eventDayDateInput = document.getElementById("eventDayDate");

    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let selectedDayForEvent = null;

    function loadEvents() {
      return JSON.parse(localStorage.getItem("calendarEvents") || "{}");
    }

    function saveEvents(e) {
      localStorage.setItem("calendarEvents", JSON.stringify(e));
    }

    function formatDate(d) {
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
    }

    function formatDisplayDate(d) {
      const p = d.split("-");
      return `${p[2]}/${p[1]}/${p[0]}`;
    }

    function renderCalendar() {
      const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
      const firstDay = firstDayOfMonth.getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      
      daysGrid.innerHTML = "";
      calendarDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
      monthSelectorBtn.textContent = monthNames[currentMonth];
      yearSelectorBtn.textContent = currentYear;

      const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();

      // Previous month's days
      for (let i = firstDay; i > 0; i--) {
        const day = daysInPrevMonth - i + 1;
        daysGrid.appendChild(createCell(day, "inactive"));
      }

      const today = new Date();
      const events = loadEvents();
      // Current month's days
      for (let d = 1; d <= daysInMonth; d++) {
        const date = new Date(currentYear, currentMonth, d);
        const key = formatDate(date);
        const cell = createCell(d, "");

        if (today.toDateString() === date.toDateString()) {
          const span = cell.querySelector(".day-number");
          span.classList.add("current-day");
        }
        
        if (events[key]?.length) {
          const dot = document.createElement("div");
          dot.className = "event-dot";
          cell.appendChild(dot);
          cell.onclick = (e) => { e.stopPropagation(); showEventDetails(key); };
        } else {
          cell.onclick = (e) => { e.stopPropagation(); showEventForm(key); };
        }
        daysGrid.appendChild(cell);
      }
      
      // Next month's days
      const totalCells = 42; // 6 rows * 7 columns
      const filledCells = firstDay + daysInMonth;
      for (let i = 1; i <= totalCells - filledCells; i++) {
        daysGrid.appendChild(createCell(i, "inactive"));
      }
    }

    function createCell(day, className) {
      const div = document.createElement("div");
      div.className = `day-cell ${className}`;
      const num = document.createElement("span");
      num.className = "day-number";
      num.textContent = day;
      div.appendChild(num);
      return div;
    }

    function changeMonth(x) {
      currentMonth += x;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }
    
    function showModal(id) {
        document.getElementById(id).classList.add('show');
    }

    function closeModal(id) {
        document.getElementById(id).classList.remove('show');
    }

    function showSelector(type) {
      selectorList.innerHTML = "";
      selectorTitle.textContent = type === "month" ? "Chọn tháng" : "Chọn năm";
      const opts = type === "month" 
        ? monthNames.map((n, i) => ({ n, i })) 
        : [...Array(11)].map((_, i) => ({ n: currentYear - 5 + i, i: currentYear - 5 + i }));

      opts.forEach(o => {
        const b = document.createElement("button");
        b.textContent = o.n;
        b.onclick = () => {
          if (type === "month") currentMonth = o.i;
          else currentYear = o.i;
          renderCalendar();
          closeModal("selectorModal");
        };
        selectorList.appendChild(b);
      });
      showModal("selectorModal");
    }

    function showEventForm(date) {
      selectedDayForEvent = date;
      eventDateDisplay.textContent = formatDisplayDate(date);
      eventDayDateInput.value = date;
      eventForm.reset();
      showModal("eventFormModal");
      document.getElementById("eventTitle").focus();
    }

    eventForm.onsubmit = e => {
      e.preventDefault();
      const title = document.getElementById("eventTitle").value;
      const details = document.getElementById("eventDetails").value;
      const date = eventDayDateInput.value;
      if (!title) return;
      const ev = loadEvents();
      if (!ev[date]) ev[date] = [];
      ev[date].push({ title, details });
      saveEvents(ev);
      renderCalendar();
      closeModal("eventFormModal");
    };

    function showEventDetails(date) {
      selectedDayForEvent = date;
      const ev = loadEvents()[date] || [];
      popupEventDate.textContent = formatDisplayDate(date);
      eventDetailsContent.innerHTML = ev.length ? ev.map(e => `<div><b>${e.title}</b><p>${e.details || "Không có chi tiết"}</p></div><hr>`).join("") : "<p>Không có sự kiện</p>";
      showModal("eventDetailsModal");
    }

    function deleteEvent() {
      if (!selectedDayForEvent) return;
      const ev = loadEvents();
      delete ev[selectedDayForEvent];
      saveEvents(ev);
      renderCalendar();
      closeModal("eventDetailsModal");
    }
    
    // --- Event Listeners ---
    document.getElementById("prevMonthBtn").onclick = () => changeMonth(-1);
    document.getElementById("nextMonthBtn").onclick = () => changeMonth(1);
    monthSelectorBtn.onclick = () => showSelector("month");
    yearSelectorBtn.onclick = () => showSelector("year");
    document.getElementById("addEventBtn").onclick = () => showEventForm(formatDate(new Date()));
    
    // Close modal on outside click
    window.addEventListener('click', (e) => {
        if (e.target.classList.contains('modal')) {
            closeModal(e.target.id);
        }
    });

    renderCalendar();
  </script>
</body>
</html>
